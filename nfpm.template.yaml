---
name: "postgresql_pglinter_${PG_MAJOR_VERSION}"
arch: "${PACKAGE_ARCH}"
platform: "linux"
version: "v${PGLINTER_MINOR_VERSION}"
section: "default"
priority: "extra"
maintainer: "pmpetit"
description: |
  pglinter analyzes database for best practice in PostgreSQL ${PG_MAJOR_VERSION}
vendor: "pmpetit"
homepage: "https://github.com/pmpetit/pglinter"
license: "PostgreSQL"
depends:
  - postgresql-${PG_MAJOR_VERSION}
contents:
  - src: ${PG_PKGLIBDIR}/pglinter.so
    dst: /usr/lib/postgresql/${PG_MAJOR_VERSION}/lib/pglinter.so
  # Install only the specific extension files, not the entire directory tree
  - src: ${PG_SHAREDIR}/extension/pglinter.control
    dst: /usr/share/postgresql/${PG_MAJOR_VERSION}/extension/pglinter.control
  - src: ${PG_SHAREDIR}/extension/pglinter--${PGLINTER_MINOR_VERSION}.sql
    dst: /usr/share/postgresql/${PG_MAJOR_VERSION}/extension/pglinter--${PGLINTER_MINOR_VERSION}.sql

overrides:
  rpm:
    # The postgres server package is named `postgresql-server` on the RHEL repo
    # and it is named `postgresql16-server` in the PGDG repo.
    # With this `depends` clause we're making sure that postgres itself is
    # installed from the PGDG repo..
    depends:
      - postgresql${PG_MAJOR_VERSION}-server
    # These locations are based on the PGDG packages, not the RedHat ones
    contents:
      - src: ${PG_PKGLIBDIR}/pglinter.so
        dst: /usr/pgsql-${PG_MAJOR_VERSION}/lib/pglinter.so
      # Install only the specific extension files, not the entire directory tree
      - src: ${PG_SHAREDIR}/extension/pglinter.control
        dst: /usr/pgsql-${PG_MAJOR_VERSION}/share/extension/pglinter.control
      - src: ${PG_SHAREDIR}/extension/pglinter--${PGLINTER_MINOR_VERSION}.sql
        dst: /usr/pgsql-${PG_MAJOR_VERSION}/share/extension/pglinter--${PGLINTER_MINOR_VERSION}.sql

---
name: "postgresql_pglinter${PG_MAJOR_VERSION}"
arch: "amd64"
platform: "linux"
version: "v${ANON_MINOR_VERSION}"
section: "default"
priority: "extra"
maintainer: "pmpetit"
description: |
  pglinter analyzes database for best practice in PostgreSQL ${PG_MAJOR_VERSION}
vendor: "pmpetit"
homepage: "https://github.com/pmpetit/pglinter"
license: "PostgreSQL"
depends:
  - postgresql-${PG_MAJOR_VERSION}
contents:
  - src: ${PG_PKGLIBDIR}/pglinter.so
    dst: /usr/lib/postgresql/${PG_MAJOR_VERSION}/lib/pglinter.so
  - src: ${PG_SHAREDIR}/extension/
    dst: /usr/share/postgresql/${PG_MAJOR_VERSION}/extension/
    type: tree

overrides:
  rpm:
    # The postgres server package is named `postgresql-server` on the RHEL repo
    # and it is named `postgresql16-server` in the PGDG repo.
    # With this `depends` clause we're making sure that postgres itself is
    # installed from the PGDG repo..
    depends:
      - postgresql${PG_MAJOR_VERSION}-server
    # These locations are based on the PGDG packages, not the RedHat ones
    contents:
      - src: ${PG_PKGLIBDIR}/pglinter.so
        dst: /usr/pgsql-${PG_MAJOR_VERSION}/lib/pglinter.so
      - src: ${PG_SHAREDIR}/extension/
        dst: /usr/pgsql-${PG_MAJOR_VERSION}/share/extension/
        type: tree

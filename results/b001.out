-- Test for dblinter B001 rule with file output
BEGIN;
CREATE TABLE IF NOT EXISTS my_table_without_pk (
    id INT,
    name TEXT,
    code TEXT,
    enable BOOL DEFAULT TRUE,
    query TEXT,
    warning_level INT,
    error_level INT,
    scope TEXT
);
CREATE EXTENSION IF NOT EXISTS dblinter;
-- Test with file output
SELECT dblinter.perform_base_check('/tmp/dblinter_base_results.sarif');
 perform_base_check 
--------------------
 t
(1 row)

-- Test if file exists
\! md5sum /tmp/dblinter_base_results.sarif
32e67d2ad135d8f404c1a9d30cfa00b7  /tmp/dblinter_base_results.sarif
-- Test with no output file (should output to prompt)  
SELECT dblinter.perform_base_check();
NOTICE:  üîç dblinter found 3 issue(s):
NOTICE:  ==================================================
NOTICE:  ‚ö†Ô∏è  [B001] WARNING: 1 tables without primary key exceed the warning threshold: 10%
NOTICE:  ‚ö†Ô∏è  [B004] WARNING: Found 1 potentially unused indexes
NOTICE:  ‚ùå [B005] ERROR: Public schema allows CREATE privilege for all users - security risk
NOTICE:  ==================================================
NOTICE:  üìä Summary: 1 error(s), 2 warning(s), 0 info
NOTICE:  üî¥ Critical issues found - please review and fix errors
 perform_base_check 
--------------------
 t
(1 row)

ROLLBACK;

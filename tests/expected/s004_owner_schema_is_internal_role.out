-- Regression test for S004: OwnerSchemaIsInternalRole
-- This test creates a schema owned by a superuser and checks that S004 identifies it.
CREATE EXTENSION IF NOT EXISTS pglinter;
ERROR:  permission denied for language c
\pset pager off
-- Setup: Create test role and schema
CREATE ROLE s004_owner LOGIN;
CREATE SCHEMA s004_schema AUTHORIZATION postgres;
ERROR:  must be member of role "postgres"
SELECT 'Testing S004 in isolation...' AS test_step;
          test_step           
------------------------------
 Testing S004 in isolation...
(1 row)

SELECT pglinter.disable_all_rules() AS all_disabled;
ERROR:  schema "pglinter" does not exist
LINE 1: SELECT pglinter.disable_all_rules() AS all_disabled;
               ^
SELECT pglinter.enable_rule('S004') AS S004_only_enabled;
ERROR:  schema "pglinter" does not exist
LINE 1: SELECT pglinter.enable_rule('S004') AS S004_only_enabled;
               ^
SELECT pglinter.check(); -- Should only run S004
ERROR:  schema "pglinter" does not exist
LINE 1: SELECT pglinter.check();
               ^
SELECT count(*) AS violation_count from pglinter.get_violations() WHERE rule_code = 'S004';
ERROR:  schema "pglinter" does not exist
LINE 1: SELECT count(*) AS violation_count from pglinter.get_violati...
                                                ^
-- Cleanup
DROP SCHEMA s004_schema CASCADE;
ERROR:  schema "s004_schema" does not exist
DROP ROLE s004_owner;
DROP EXTENSION pglinter CASCADE;
ERROR:  extension "pglinter" does not exist

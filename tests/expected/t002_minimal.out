-- Test for pglinter T002 rule: Tables with redundant indexes (minimal test)
CREATE EXTENSION pglinter;
\pset pager off
-- Create one simple test table
CREATE TABLE test_redundant (
    id INT PRIMARY KEY,
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    tel TEXT
);
-- Create two identical indexes (redundant)
CREATE INDEX idx_name_1 ON test_redundant (first_name);
CREATE INDEX idx_name_2 ON test_redundant (first_name,last_name);
CREATE INDEX idx_name_3 ON test_redundant (first_name,last_name,tel);
CREATE INDEX idx_name_4 ON test_redundant (tel,last_name);
-- Enable only T002
SELECT pglinter.disable_all_rules();
NOTICE:  üî¥ Disabled 23 rule(s)
 disable_all_rules 
-------------------
                23
(1 row)

SELECT pglinter.enable_rule('T002');
NOTICE:  ‚úÖ Rule T002 has been enabled
 enable_rule 
-------------
 t
(1 row)

-- Test T002
SELECT pglinter.perform_table_check();
NOTICE:  üîç pglinter found 1 issue(s):
NOTICE:  ==================================================
NOTICE:  ‚ö†Ô∏è  [T002] WARNING: TABLE duplicated index 3 : 
public.test_redundant idx idx_name_1 columns (first_name) is a subset of idx idx_name_2 columns (first_name,last_name)
public.test_redundant idx idx_name_1 columns (first_name) is a subset of idx idx_name_3 columns (first_name,last_name,tel)
public.test_redundant idx idx_name_2 columns (first_name,last_name) is a subset of idx idx_name_3 columns (first_name,last_name,tel) 

NOTICE:  ==================================================
NOTICE:  üìä Summary: 0 error(s), 1 warning(s), 0 info
NOTICE:  üü° Some warnings found - consider reviewing for optimization
 perform_table_check 
---------------------
 t
(1 row)

-- Cleanup
DROP TABLE test_redundant CASCADE;
DROP EXTENSION pglinter CASCADE;
